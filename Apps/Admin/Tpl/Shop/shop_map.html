<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Xenon Boostrap Admin Panel" />
  <meta name="author" content="" />

  <title>水见管理后台</title>

  <link rel="stylesheet" href="http://fonts.useso.com/css?family=Arimo:400,700,400italic">
  <link rel="stylesheet" href="__PUBLIC__/Admin/css/fonts/linecons/css/linecons.css">
  <link rel="stylesheet" href="__PUBLIC__/Admin/css/fonts/fontawesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="__PUBLIC__/Admin/css/bootstrap.css">
  <link rel="stylesheet" href="__PUBLIC__/Admin/css/xenon-core.css">
  <link rel="stylesheet" href="__PUBLIC__/Admin/css/xenon-forms.css">
  <link rel="stylesheet" href="__PUBLIC__/Admin/css/xenon-components.css">
  <link rel="stylesheet" href="__PUBLIC__/Admin/css/xenon-skins.css">
  <link rel="stylesheet" href="__PUBLIC__/Admin/css/custom.css">

  <script src="__PUBLIC__/Admin/js/jquery-1.11.1.min.js"></script>
  <script src="__PUBLIC__/Admin/js/project/functions.js"></script>
  <script src="__PUBLIC__/Admin/js/project/shop.js"></script>

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->


</head>
<body class="page-body">

<div class="settings-pane">

  <a href="#" data-toggle="settings-pane" data-animate="true">
    &times;
  </a>
</div>

<div class="page-container"><!-- add class "sidebar-collapsed" to close sidebar by default, "chat-visible" to make chat appear always -->

  <!-- Add "fixed" class to make the sidebar fixed always to the browser viewport. -->
  <!-- Adding class "toggle-others" will keep only one menu item open at a time. -->
  <!-- Adding class "collapsed" collapse sidebar root elements and show only icons. -->
  <div class="sidebar-menu toggle-others fixed">

    <div class="sidebar-menu-inner">

      <header class="logo-env">

        <!-- logo -->
        <div class="logo">
          <a href="dashboard-1.html" class="logo-expanded">
            <img src="__PUBLIC__/Admin/images/logo@2x.png" width="80" alt="" />
          </a>

          <a href="dashboard-1.html" class="logo-collapsed">
            <img src="__PUBLIC__/Admin/images/logo-collapsed@2x.png" width="40" alt="" />
          </a>
        </div>

        <!-- This will toggle the mobile menu and will be visible only on mobile devices -->
        <div class="mobile-menu-toggle visible-xs">
          <a href="#" data-toggle="user-info-menu">
            <i class="fa-bell-o"></i>
            <span class="badge badge-success">7</span>
          </a>

          <a href="#" data-toggle="mobile-menu">
            <i class="fa-bars"></i>
          </a>
        </div>

        <!-- This will open the popup with user profile settings, you can use for any purpose, just be creative -->
        <div class="settings-icon">
          <a href="#" data-toggle="settings-pane" data-animate="true">
            <i class="linecons-cog"></i>
          </a>
        </div>


      </header>



      <include file="Common:left"/>

    </div>

  </div>

  <div class="main-content">

    <!-- User Info, Notifications and Menu Bar -->
    <div class="page-title">

      <div class="title-env">
        <h1 class="title">店铺派送区</h1>
        <p class="description">Shop Maps Management</p>
      </div>

      <include file="Common:breadcrumb"/>

    </div>

    <style type="text/css">
      body, html{width: 100%;height: 100%;overflow: hidden;margin:0;}
      #allmap {height: 500px;overflow: hidden;}
      #result {border-left:1px dotted #999;height:100%;width:295px;position:absolute;top:0px;right:0px;font-size:12px;}
      dl,dt,dd,ul,li{
        margin:0;
        padding:0;
        list-style:none;
      }
      p{font-size:12px;}
      dt{
        font-size:14px;
        font-family:"微软雅黑";
        font-weight:bold;
        border-bottom:1px dotted #000;
        padding:5px 0 5px 5px;
        margin:5px 0;
      }
      dd{
        padding:5px 0 0 5px;
      }
      li{
        line-height:28px;
      }
      .red{color: red;}
    </style>

    <script src="http://api.map.baidu.com/api?v=2.0&amp;ak=jmjSS8oYFwkyqEx0o99q9w3N"></script>
    <script src="http://api.map.baidu.com/api?v=2.0&ak=jmjSS8oYFwkyqEx0o99q9w3N"></script>
    <!--加载鼠标绘制工具-->
    <script type="text/javascript" src="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.js"></script>
    <link rel="stylesheet" href="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.css" />
    <!--加载检索信息窗口-->
    <script type="text/javascript" src="http://api.map.baidu.com/library/SearchInfoWindow/1.4/src/SearchInfoWindow_min.js"></script>
    <link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.4/src/SearchInfoWindow_min.css" />
    <div class="row">
      <div class="col-sm-12">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">派送区管理</h3>
            <br>
            <span style="font-size: 12px;color:red">1.绘制多边形时，双击可结束绘制； 2.左单击可以进行修改，右击可以进行删除； 3.新绘制的区域要立即保存，否则无法保存，只能删除后重新绘制</span>
          </div>

          <div class="panel-body">
            <div id="allmap" style="overflow:hidden;zoom:1;position:relative">
              <div id="map" style="height:100%;-webkit-transition: all 0.5s ease-in-out;transition: all 0.5s ease-in-out;"></div>
              <div id="panelWrap" style="width:0px;position:absolute;top:0px;right:0px;height:100%;overflow:auto;-webkit-transition: all 0.5s ease-in-out;transition: all 0.5s ease-in-out;">
                <div style="width:20px;height:200px;margin:-100px 0 0 -10px;color:#999;position:absolute;opacity:0.5;top:50%;left:50%;" id="showOverlayInfo">此处用于展示覆盖物信息</div>
                <div id="panel" style="position:absolute;"></div>
              </div>
            </div>
            <input id="shopMapShopId" type="hidden" name="shopId" value="{$Think.get.shopid}">
          </div>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      $(function(){
        // 百度地图API功能
        var map = new BMap.Map('map');
        var poi = new BMap.Point(121.327271,31.200592);
        map.centerAndZoom(poi, 16);
        map.enableScrollWheelZoom();
        //初始化
        var sContent ='<div style="margin-top:20px;">派送名：<input type="text" class="addPolygonLabelMessage" value="">&nbsp;&nbsp;<input type="button" class="savePolygonMessage btn btn-success btn-sm" value="保存"></div>';
        var infoWindow = new BMap.InfoWindow(sContent);  // 创建信息窗口对象
        infoWindow.setWidth(300);
        infoWindow.setHeight(50);
        //覆盖物样式
        var styleOptions = {
          strokeColor:"red",    //边线颜色。
          fillColor:"red",      //填充颜色。当参数为空时，圆形将没有填充效果。
          strokeWeight: 3,       //边线的宽度，以像素为单位。
          strokeOpacity: 0.8,	   //边线透明度，取值范围0 - 1。
          fillOpacity: 0.6,      //填充的透明度，取值范围0 - 1。
          strokeStyle: 'solid' //边线的样式，solid或dashed。
        }
        //标签样式
        var labelStyle = {
          border:0,
          backgroundColor:'',
          padding:'3px',
        }

        //=========权限判断start==================================
        //客服登陆2   只能查看
        //其他角色

        //实例化鼠标绘制工具
        var drawingManager = new BMapLib.DrawingManager(map, {
          isOpen: false, //是否开启绘制模式
          enableDrawingTool: true, //是否显示工具栏
          drawingToolOptions: {
            anchor: BMAP_ANCHOR_TOP_RIGHT, //位置
            offset: new BMap.Size(5, 5), //偏离值
            drawingModes : [BMAP_DRAWING_POLYGON, BMAP_DRAWING_RECTANGLE],
          },
          circleOptions: styleOptions, //圆的样式
          polylineOptions: styleOptions, //线的样式
          polygonOptions: styleOptions, //多边形的样式
          rectangleOptions: styleOptions //矩形的样式
        });
        //鼠标绘制执行
        var overlaycomplete = function(e){
          var eoverlay = e.overlay;
          var thisTarget = eoverlay.getPath();
          //添加信息窗口
          var thisPoint = new BMap.Point(thisTarget[0].lng,thisTarget[0].lat);
          var sContent ='<div style="margin-top:20px;">派送名：<input type="text" class="addPolygonLabelMessage" value="">&nbsp;&nbsp;<input type="button" class="savePolygonMessage btn btn-success btn-sm" value="保存"></div>';
          var infoWindow = new BMap.InfoWindow(sContent);  // 创建信息窗口对象
          map.openInfoWindow(infoWindow,thisPoint); //开启信息窗口
          infoWindow.addEventListener('clickclose',function() {
            eoverlay.disableEditing();
          });
          infoWindow.addEventListener('close',function() {
            var labelInfo = $(".addPolygonLabelMessage").val();
            if(labelInfo == '' || labelInfo == null) {
              labelInfo = '请输入名字';
            }
            var shopId = $("#shopMapShopId").val();
            if(shopId == '' || shopId == null) {
              alert('没找到店铺Id');return;
            }
            var lngAndLat = new Array();
            $.each(eoverlay.getPath(),function(i,item) {
              var lngAndLatDate = new Array();
              lngAndLatDate[0] = item.lng;
              lngAndLatDate[1] = item.lat;
              lngAndLat[i] = lngAndLatDate;
            });
            var lngAndLatSize = new Array();
            lngAndLatSize[0] = eoverlay.getBounds().getNorthEast().lng;	//最大经度
            lngAndLatSize[1] = eoverlay.getBounds().getNorthEast().lat;	//最大维度
            lngAndLatSize[2] = eoverlay.getBounds().getSouthWest().lng;	//最小经度
            lngAndLatSize[3] = eoverlay.getBounds().getSouthWest().lat;	//最小维度
            if(lngAndLatSize[0] == null || lngAndLatSize[1] == null || lngAndLatSize[2] == null || lngAndLatSize[3] == null) {
              alert('没有获取到最大和最小经纬度');
            }
            if((lngAndLatSize[0] == lngAndLatSize[2]) && (lngAndLatSize[1] == lngAndLatSize[3])) {
              alert('不能保存为点');
              map.closeInfoWindow(thisPoint); //关闭信息窗口
              map.removeOverlay(eoverlay);
              return;
            }
            var labelInfo = $(".addPolygonLabelMessage").val();
            if(labelInfo == '' || labelInfo == null) {
              labelInfo = '请输入名字';
              var obj = DoAjaxPost('/iadmin.php/Shop/add_map',{shopId:shopId,labelInfo:labelInfo,lngAndLat:JSON.stringify(lngAndLat),lngAndLatSize:JSON.stringify(lngAndLatSize)});
              if(obj.title == 'success'){
                eoverlay.disableEditing();
                thisTarget = eoverlay.getPath();
                thisPoint = new BMap.Point(thisTarget[0].lng,thisTarget[0].lat);
                //添加文字标注
                map.removeOverlay(label);
                label = new BMap.Label(labelInfo,{position:thisPoint});
                label.setStyle(labelStyle);
                map.addOverlay(label);
                sContent ='<div style="margin-top:20px;">派送名：<input type="text" class="addPolygonLabelMessage" value="'+labelInfo+'"><input type="hidden" class="getMapServiceSiteId" name="shipAreaId" value="'+obj.data+'">&nbsp;&nbsp;<input type="button" class="savePolygonMessage btn btn-success btn-sm" value="保存"></div>';
                infoWindow = new BMap.InfoWindow(sContent);  // 创建信息窗口对象
                infoWindow.addEventListener('clickclose',function() {
                  eoverlay.disableEditing();
                });
                map.closeInfoWindow(thisPoint); //关闭信息窗口
              } else {
                alert(obj.data);
              }
            }
          });
          var label;
          $(".savePolygonMessage").click(function() {
            var labelInfo = $(".addPolygonLabelMessage").val();
            if(labelInfo == '' || labelInfo == null) {
              alert('名字不能为空');return;
            }
            var shopId = $("#shopMapShopId").val();
            if(shopId == '' || shopId == null) {
              alert('没找到店铺Id');return;
            }
            var lngAndLat = new Array();
            $.each(eoverlay.getPath(),function(i,item) {
              var lngAndLatDate = new Array();
              lngAndLatDate[0] = item.lng;
              lngAndLatDate[1] = item.lat;
              lngAndLat[i] = lngAndLatDate;
            });
            var lngAndLatSize = new Array();
            lngAndLatSize[0] = eoverlay.getBounds().getNorthEast().lng;	//最大经度
            lngAndLatSize[1] = eoverlay.getBounds().getNorthEast().lat;	//最大维度
            lngAndLatSize[2] = eoverlay.getBounds().getSouthWest().lng;	//最小经度
            lngAndLatSize[3] = eoverlay.getBounds().getSouthWest().lat;	//最小维度
            if(lngAndLatSize[0] == null || lngAndLatSize[1] == null || lngAndLatSize[2] == null || lngAndLatSize[3] == null) {
              alert('没有获取到最大和最小经纬度');
            }
            if((lngAndLatSize[0] == lngAndLatSize[2]) && (lngAndLatSize[1] == lngAndLatSize[3])) {
              alert('不能保存为点');
              map.closeInfoWindow(thisPoint); //关闭信息窗口
              map.removeOverlay(eoverlay);
              return;
            }
            var obj = DoAjaxPost('/iadmin.php/Shop/add_map',{shopId:shopId,labelInfo:labelInfo,lngAndLat:JSON.stringify(lngAndLat),lngAndLatSize:JSON.stringify(lngAndLatSize)});
            if(obj.title == 'success'){
              eoverlay.disableEditing();
              thisTarget = eoverlay.getPath();
              thisPoint = new BMap.Point(thisTarget[0].lng,thisTarget[0].lat);
              //添加文字标注
              map.removeOverlay(label);
              label = new BMap.Label(labelInfo,{position:thisPoint});
              label.setStyle(labelStyle);
              map.addOverlay(label);
              sContent ='<div style="margin-top:20px;">派送名：<input type="text" class="addPolygonLabelMessage" value="'+labelInfo+'"><input type="hidden" class="getMapServiceSiteId" name="shipAreaId" value="'+obj.data+'">&nbsp;&nbsp;<input type="button" class="savePolygonMessage btn btn-success btn-sm" value="保存"></div>';
              infoWindow = new BMap.InfoWindow(sContent);  // 创建信息窗口对象
              infoWindow.addEventListener('clickclose',function() {
                eoverlay.disableEditing();
              });
              map.closeInfoWindow(thisPoint); //关闭信息窗口
            } else {
              alert(obj.data);
            }
          });
          //给覆盖物添加事件
          eoverlay.addEventListener("click",function() {
            eoverlay.enableEditing();
            map.openInfoWindow(infoWindow,thisPoint); //开启信息窗口
            $(".savePolygonMessage").click(function() {
              var labelInfo = $(".addPolygonLabelMessage").val();
              var shipAreaId = $(".getMapServiceSiteId").val();
              if(labelInfo == '' || labelInfo == null) {
                alert('名字不能为空');return;
              }
              if(shipAreaId == '' || shipAreaId == null) {
                alert('派送ID不能为空');return;
              }
              var lngAndLat = new Array();
              $.each(eoverlay.getPath(),function(i,item) {
                var lngAndLatDate = new Array();
                lngAndLatDate[0] = item.lng;
                lngAndLatDate[1] = item.lat;
                lngAndLat[i] = lngAndLatDate;
              });
              var lngAndLatSize = new Array();
              lngAndLatSize[0] = eoverlay.getBounds().getNorthEast().lng;	//最大经度
              lngAndLatSize[1] = eoverlay.getBounds().getNorthEast().lat;	//最大维度
              lngAndLatSize[2] = eoverlay.getBounds().getSouthWest().lng;	//最小经度
              lngAndLatSize[3] = eoverlay.getBounds().getSouthWest().lat;	//最小维度
              if(lngAndLatSize[0] == null || lngAndLatSize[1] == null || lngAndLatSize[2] == null || lngAndLatSize[3] == null) {
                alert('没有获取到最大和最小经纬度');
              }
              if((lngAndLatSize[0] == lngAndLatSize[2]) && (lngAndLatSize[1] == lngAndLatSize[3])) {
                alert('不能保存为点');
                map.closeInfoWindow(thisPoint); //关闭信息窗口
                map.removeOverlay(eoverlay);
                return;
              }
              var obj = DoAjaxPost('/iadmin.php/Shop/edit_map',{shipAreaId:shipAreaId,labelInfo:labelInfo,lngAndLat:JSON.stringify(lngAndLat),lngAndLatSize:JSON.stringify(lngAndLatSize)});
              if(obj.title == 'success'){
                eoverlay.disableEditing();
                thisTarget = eoverlay.getPath();
                thisPoint = new BMap.Point(thisTarget[0].lng,thisTarget[0].lat);
                //添加文字标注
                map.removeOverlay(label);
                label = new BMap.Label(labelInfo,{position:thisPoint});
                label.setStyle(labelStyle);
                map.addOverlay(label);
                sContent ='<div style="margin-top:20px;">派送名：<input type="text" class="addPolygonLabelMessage" value="'+labelInfo+'"><input type="hidden" class="getMapServiceSiteId" name="shipAreaId" value="'+shipAreaId+'">&nbsp;&nbsp;<input type="button" class="savePolygonMessage btn btn-success btn-sm" value="保存"></div>';
                infoWindow = new BMap.InfoWindow(sContent);  // 创建信息窗口对象
                infoWindow.addEventListener('clickclose',function() {
                  eoverlay.disableEditing();
                });
                map.closeInfoWindow(thisPoint); //关闭信息窗口
              } else {
                alert(obj.data);
              }
            });
          });
          //创建右键菜单
          var markerMenu=new BMap.ContextMenu();
          markerMenu.addItem(new BMap.MenuItem('删除',function() {
            if(!confirm("确定要删除吗")) return;
            map.openInfoWindow(infoWindow,thisPoint); //开启信息窗口
            var shipAreaId = $(".getMapServiceSiteId").val();
            if(shipAreaId) {
              var obj = DoAjaxPost('/iadmin.php/Shop/del_map',{shipAreaId:shipAreaId});
              if(obj.title == 'success'){
                map.removeOverlay(eoverlay);
                map.removeOverlay(label);
              } else {
                alert(obj.data);
              }
            } else {
              map.removeOverlay(eoverlay);
              map.removeOverlay(label);
            }
            map.closeInfoWindow(thisPoint); //关闭信息窗口
          }));
          eoverlay.addContextMenu(markerMenu);

        };

        //添加鼠标绘制工具监听事件，用于获取绘制结果
        drawingManager.addEventListener('overlaycomplete', overlaycomplete);

        //其他区块派送区域
        var arrayinfoShowOnly = "";	    //创建配送范围
        $.each(arrayinfoShowOnly,function(i,item) {
          var mapPoint = new Array();
          $.each(item[1],function(j,data) {
            mapPoint[j] = new BMap.Point(data[0],data[1]);
          });
          var rectangleShowOnly = new BMap.Polygon(mapPoint, {strokeColor:"blue", strokeWeight:2, strokeOpacity:0.5});
          map.addOverlay(rectangleShowOnly);
          //添加文字标注
          map.removeOverlay(label);
          var label = new BMap.Label(item[0][0],{position:mapPoint[0]});
          label.setStyle(labelStyle);
          map.addOverlay(label);
        });


        //当前区块派送区域
        var arrayinfo = {$mapresult};		//创建配送范围
        $.each(arrayinfo,function(i,item) {
          var mapPoint = new Array();
          $.each(item[1],function(j,data) {
            mapPoint[j] = new BMap.Point(data[0],data[1]);
          });
          var rectangle = new BMap.Polygon(mapPoint, styleOptions);
          map.addOverlay(rectangle);
          //添加文字标注
          map.removeOverlay(label);
          var label = new BMap.Label(item[0][0],{position:mapPoint[0]});
          label.setStyle(labelStyle);
          map.addOverlay(label);
          var thisTarget = rectangle.getPath();
          //添加信息窗口
          var thisPoint = new BMap.Point(thisTarget[0].lng,thisTarget[0].lat);
          map.closeInfoWindow(thisPoint);
          var sContent ='<div style="margin-top:20px;">派送名：<input type="text" class="addPolygonLabelMessage" value="'+item[0][0]+'"><input type="hidden" class="getMapServiceSiteId" name="shipAreaId" value="'+item[0][1]+'">&nbsp;&nbsp;<input type="button" class="savePolygonMessage btn btn-success btn-sm" value="保存"></div>';
          var infoWindow = new BMap.InfoWindow(sContent);  // 创建信息窗口对象
          infoWindow.addEventListener('clickclose',function() {
            rectangle.disableEditing();
          });
          //覆盖物改变，文字标注也改变
          rectangle.addEventListener('lineupdate',function() {
            var labelInfo = $(".addPolygonLabelMessage").val();
            thisTarget = rectangle.getPath();
            thisPoint = new BMap.Point(thisTarget[0].lng,thisTarget[0].lat);
            //添加文字标注
            map.removeOverlay(label);
            label = new BMap.Label(item[0][0],{position:thisPoint});
            label.setStyle(labelStyle);
            map.addOverlay(label);
          });
          //给覆盖物添加事件
          rectangle.addEventListener("click",function() {
            rectangle.enableEditing();
            map.openInfoWindow(infoWindow,thisPoint); //开启信息窗口
            $(".savePolygonMessage").click(function() {
              var labelInfo = $(".addPolygonLabelMessage").val();
              var shipAreaId = $(".getMapServiceSiteId").val();
              if(labelInfo == '' || labelInfo == null) {
                alert('名字不能为空');return;
              }
              if(shipAreaId == '' || shipAreaId == null) {
                alert('派送ID不能为空');return;
              }
              var lngAndLat = new Array();
              $.each(rectangle.getPath(),function(i,item) {
                var lngAndLatDate = new Array();
                lngAndLatDate[0] = item.lng;
                lngAndLatDate[1] = item.lat;
                lngAndLat[i] = lngAndLatDate;
              });
              var lngAndLatSize = new Array();
              lngAndLatSize[0] = rectangle.getBounds().getNorthEast().lng;	//最大经度
              lngAndLatSize[1] = rectangle.getBounds().getNorthEast().lat;	//最大维度
              lngAndLatSize[2] = rectangle.getBounds().getSouthWest().lng;	//最小经度
              lngAndLatSize[3] = rectangle.getBounds().getSouthWest().lat;	//最小维度
              if(lngAndLatSize[0] == null || lngAndLatSize[1] == null || lngAndLatSize[2] == null || lngAndLatSize[3] == null) {
                alert('没有获取到最大和最小经纬度');
              }
              if((lngAndLatSize[0] == lngAndLatSize[2]) && (lngAndLatSize[1] == lngAndLatSize[3])) {
                alert('不能保存为点');
                map.closeInfoWindow(thisPoint); //关闭信息窗口
                map.removeOverlay(rectangle);
                return;
              }
              var obj = DoAjaxPost('/iadmin.php/Shop/edit_map',{shipAreaId:shipAreaId,labelInfo:labelInfo,lngAndLat:JSON.stringify(lngAndLat),lngAndLatSize:JSON.stringify(lngAndLatSize)});
              if(obj.title == 'success'){
                rectangle.disableEditing();
                thisTarget = rectangle.getPath();
                thisPoint = new BMap.Point(thisTarget[0].lng,thisTarget[0].lat);
                //添加文字标注
                map.removeOverlay(label);
                label = new BMap.Label(labelInfo,{position:thisPoint});
                label.setStyle(labelStyle);
                map.addOverlay(label);
                sContent ='<div style="margin-top:20px;">派送名：<input type="text" class="addPolygonLabelMessage" value="'+labelInfo+'"><input type="hidden" class="getMapServiceSiteId" name="shipAreaId" value="'+item[0][1]+'">&nbsp;&nbsp;<input type="button" class="savePolygonMessage btn btn-success btn-sm" value="保存"></div>';
                infoWindow = new BMap.InfoWindow(sContent);  // 创建信息窗口对象
                infoWindow.addEventListener('clickclose',function() {
                  rectangle.disableEditing();
                });
                map.closeInfoWindow(thisPoint); //关闭信息窗口
              } else {
                alert(obj.data);
              }
            });
          });
          //创建右键菜单
          var markerMenu=new BMap.ContextMenu();
          markerMenu.addItem(new BMap.MenuItem('删除',function() {
            if(!confirm("确定要删除吗")) return;
            map.openInfoWindow(infoWindow,thisPoint); //开启信息窗口
            var shipAreaId = $(".getMapServiceSiteId").val();
            if(shipAreaId == '' || shipAreaId == null) {
              alert('无法获取派送点id');
              return;
            }
            var obj = DoAjaxPost('/iadmin.php/Shop/del_map',{shipAreaId:shipAreaId});
            if(obj.title == 'success'){
              map.removeOverlay(rectangle);
              map.removeOverlay(label);
            } else {
              alert(obj.data);
            }
            map.closeInfoWindow(thisPoint); //关闭信息窗口
          }));
          rectangle.addContextMenu(markerMenu);
        });

        //=========权限判断end======
      });
    </script>

  </div>
</div>



<include file="Common:modal"/>


<!-- Bottom Scripts -->
<script src="__PUBLIC__/Admin/js/bootstrap.min.js"></script>
<script src="__PUBLIC__/Admin/js/TweenMax.min.js"></script>
<script src="__PUBLIC__/Admin/js/resizeable.js"></script>
<script src="__PUBLIC__/Admin/js/joinable.js"></script>
<script src="__PUBLIC__/Admin/js/xenon-api.js"></script>
<script src="__PUBLIC__/Admin/js/xenon-toggles.js"></script>


<!-- Imported scripts on this page -->
<script src="__PUBLIC__/Admin/js/rwd-table/js/rwd-table.min.js"></script>


<!-- JavaScripts initializations and stuff -->
<script src="__PUBLIC__/Admin/js/xenon-custom.js"></script>

</body>
</html>
