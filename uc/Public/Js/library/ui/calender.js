BQ.add("ui.form.Calender",function(h){function g(b,a){function d(){var a=c.element.offset();a.top+=c.element.height();c.block.css({top:a.top,left:a.left})}var e=this;if(!(e instanceof g))return new g(b,h.merge(i,a));e.config=a;e.variable={block:null,top:null,element:null,year:null,month:null,main:null,date:null,main:null,flag:!0,note:{currentDay:null,allDays:[],element:null,date:{}},xingqi:["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],daysnum:[31,28,31,30,31,30,31,31,30,31,30,31]};
var c=e.variable;c.element=$(b);if(a.useDefaultModel==!0){e.createModel();c.element.focus(function(){d();if(!e.onEmpty()){var a=new Date;c.note.date.year=a.getFullYear();c.note.date.month=a.getMonth()+1;c.note.date.day=a.getDate()}e.show();e.setDate(c.note.date.year,c.note.date.month-1)});var f=!0;c.element.blur(function(){setTimeout(function(){f==!0&&e.hide()},150)});$(window).resize(function(){d()})}else a.today=$(a.today),a.days=$(a.days),a.prevY=$(a.prevY),a.prevM=$(a.prevM),a.nextY=$(a.nextY),
a.nextM=$(a.nextM),e.onEmpty(),e.setDate(c.note.date.year,c.note.date.month-1);a.prevY.click(function(b){b.stopPropagation();a.useDefaultModel==!0&&(f=!1,setTimeout(function(){f=!0},200));c.note.date.year--;e.setDate(c.note.date.year,c.note.date.month-1);c.element.focus()});a.prevM.click(function(b){b.stopPropagation();a.useDefaultModel==!0&&(f=!1,setTimeout(function(){f=!0},200));c.note.date.month--;if(c.note.date.month<1)c.note.date.year--,c.note.date.month=12;e.setDate(c.note.date.year,c.note.date.month-
1);c.element.focus()});a.nextY.click(function(b){b.stopPropagation();a.useDefaultModel==!0&&(f=!1,setTimeout(function(){f=!0},200));c.note.date.year++;e.setDate(c.note.date.year,c.note.date.month-1);c.element.focus()});a.nextM.click(function(b){b.stopPropagation();a.useDefaultModel==!0&&(f=!1,setTimeout(function(){f=!0},200));c.note.date.month++;if(c.note.date.month>12)c.note.date.year++,c.note.date.month=1;e.setDate(c.note.date.year,c.note.date.month-1);c.element.focus()});a.today.click(function(b){b.stopPropagation();
a.useDefaultModel==!0&&(f=!1,setTimeout(function(){f=!0},200))});a.days.bind("click",function(a){a.stopPropagation();a=$(this);e.clickChangeDate(a)});c.note.element=a.days}var i={useDefaultModel:!0,today:null,prevY:null,prevM:null,nextY:null,nextM:null,days:null,callback:null};h.augment(g,{createModel:function(){var b=this.variable,a=this.config,d=join('<style type="text/css">',".cal_container{width:196px;height:212px;margin:5px auto;position:relative;background:#f6f8fc;border:solid 1px #D1DFF2;font:12px/1.5 Arial;-moz-user-select:none;-webkit-user-select:none;}",
".cal_container .cal_top{line-height:30px;position:relative;background:#A6C6E6;color:#fff;text-align:center;zoom:1;}",".cal_container .cal_top .today{width:100px;line-height:30px;margin:0px auto;color:#fff;overflow:hidden;}",".cal_container .cal_top .today div{display:inline}",".cal_container .prevY, .cal_container .prevM, .cal_container .nextM, .cal_container .nextY{width:25px;height:20px;line-height:20px;position:absolute;top:5px;cursor:pointer;font-family:serif;color:#e7f2fd;}",".cal_container .prevY{left:3px;}",
".cal_container .prevM{left:28px;}",".cal_container .nextM{right:28px;}",".cal_container .nextY{right:3px;}",".cal_container .prevY:hover, .cal_container .prevM:hover, .cal_container .nextM:hover, .cal_container .nextY:hover{color:#f8fafc;text-shadow:0 0 2px rgba(255,255,255,.8);}",".cal_container .cal_xingqi{overflow:hidden}",".cal_container .cal_xingqi div{width:24px;line-height:22px;text-align:center;margin:2px;float:left;background:#A6C6E6;display:inline;color:#eef5fc;cursor:default;}",".cal_container .cal_main{overflow:hidden;}",
".cal_container .cal_main div{width:24px;height:22px;margin:2px;float:left;line-height:22px;text-align:center;background:#e3ecfc;display:inline;cursor:pointer;color:#61656e;}",".cal_container .cal_main div:hover{background:#8ec2f5;color:#e7f3ff;}",".cal_container .cal_main .current{background:#79b2eb;color:#e7f3ff;}","</style>");b.block=join('<div class="cal_container">','<div style="width:192px;height:205px;"><iframe style="width:196px;height:212px;border:none;"></iframe></div>','<div style="position:absolute;left:0px;top:0px;z-index:10;">',
'<div class="cal_top">','<div class="prevY">&lt;&lt;</div>','<div class="prevM">&lt;</div>','<div class="today">','<div class="year">2011\u5e74</div><div class="month">5\u6708</div><div class="date">9\u65e5</div>',"</div>",'<div class="nextY">&gt;&gt;</div>','<div class="nextM">&gt;</div>',"</div>",'<div class="cal_xingqi"><div>\u65e5</div><div>\u4e00</div><div>\u4e8c</div><div>\u4e09</div><div>\u56db</div><div>\u4e94</div><div>\u516d</div></div>','<div class="cal_main">',"<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>",
"<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>","<div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div>","</div>",'<div class="cal_button">',"</div>","</div>","</div>");b.block=$(b.block);b.block.css({position:"absolute",display:"none"});$("body").append(b.block);$("body").append(d);a.today=
b.block.find(".today");a.prevY=b.block.find(".prevY");a.prevM=b.block.find(".prevM");a.nextY=b.block.find(".nextY");a.nextM=b.block.find(".nextM");b.year=b.block.find(".year");b.month=b.block.find(".month");b.date=b.block.find(".date");a.days=b.block.find(".cal_main>div");b.note.element=a.days},setDate:function(b,a){var d=this.variable,e=this.config;b%100!=0?d.daysnum[1]=b%4==0?29:28:d.daysnum[1]=b%400==0?29:28;e.useDefaultModel==!0?(d.year.text(d.note.date.year+"\u5e74"),d.month.text(d.note.date.month+
"\u6708"),d.date.text(d.note.date.day+"\u65e5")):e.today.text(d.note.date.year+"\u5e74"+d.note.date.month+"\u6708"+d.note.date.day+"\u65e5");var c=(new Date(b,a,1,0,0,0)).getDay();e.days.each(function(){$(this).text("")});for(var f=d.note.allDays.length=0;f<d.daysnum[a];f++)e.days.eq(c+f).text(f+1),d.note.allDays.push(e.days.eq(c+f));if(d.flag==!0)d.note.currentDay=d.note.allDays[d.note.date.day-1];d.flag=!0;e.useDefaultModel?(d.note.element.removeClass("current"),d.note.currentDay.addClass("current")):
(e.days.removeClass(e.activeCls),d.note.currentDay.addClass(e.activeCls));e.today.trigger("switch",d.note)},onEmpty:function(){var b=this.variable,a=b.element.val().match(/\d+/g),d=/^0+/;return a&&a.length==3?(b.note.date.year=a[0],b.note.date.month=a[1].replace(d,""),b.note.date.day=a[2].replace(d,""),b.note.date.year.length!=4||b.note.date.month>12||b.note.date.day>31?!1:!0):!1},clickChangeDate:function(b){var a=this.variable,d=this.config;a.flag=!1;if(b.text()!="")a.note.currentDay=b,a.note.date.day=
parseInt(b.text()),this.reset(),d.today.trigger("switch",a.note)},show:function(){this.variable.block.show()},reset:function(){var b=this.variable,a=this.config;a.useDefaultModel?(b.note.currentDay.addClass("current"),b.date.text(b.note.date.day+"\u65e5")):(a.days.removeClass(a.activeCls),b.note.currentDay.addClass(a.activeCls),a.today.text(b.note.date.year+"\u5e74"+b.note.date.month+"\u6708"+b.note.date.day+"\u65e5"))},removeEvent:function(b){var a=this,d=a.config;d.days.unbind(b);d.days.bind("click",
function(){var b=$(this);a.clickChangeDate(b)})},hide:function(){this.variable.block.hide()},on:function(b){this.config.today.bind("switch",function(a,d){b(d)})},triggerOn:function(){this.config.today.trigger("switch",this.variable.note)}});return g});
