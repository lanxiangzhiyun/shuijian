BQ.add("ui.form.Calender",function(l){function p(A,B){function p(){var g={"2011-12-25":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u5723\u8bde\u8282",info:""},"2012-01-01":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u5143\u65e6\u8282",info:""},"2012-01-22":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u9664\u5915",info:""},"2012-01-23":{afterTime:3,beforeTime:3,dayindex:1,holidayName:"\u6625\u8282",info:""},"2012-02-06":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u5143\u5bb5\u8282",
info:""},"2012-02-14":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u60c5\u4eba\u8282",info:""},"2012-03-08":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u5987\u5973\u8282",info:""},"2012-03-14":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u767d\u8272\u60c5\u4eba\u8282",info:""},"2012-04-04":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u6e05\u660e\u8282",info:""},"2012-05-01":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u52b3\u52a8\u8282",info:""},"2012-06-01":{afterTime:3,
beforeTime:3,dayindex:0,holidayName:"\u513f\u7ae5\u8282",info:""},"2012-06-23":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u7aef\u5348\u8282",info:""},"2012-08-01":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u5efa\u519b\u8282",info:""},"2012-09-10":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u6559\u5e08\u8282",info:""},"2012-09-30":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u4e2d\u79cb\u8282",info:""},"2012-10-01":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u56fd\u5e86\u8282",
info:""},"2012-12-25":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u5723\u8bde\u8282",info:""},"2013-01-01":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u5143\u65e6\u8282",info:""},"2013-02-10":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u6625\u8282",info:""},"2013-02-24":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u5143\u5bb5\u8282",info:""},"2013-04-04":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u6e05\u660e\u8282",info:""},"2013-05-01":{afterTime:3,beforeTime:3,
dayindex:0,holidayName:"\u52b3\u52a8\u8282",info:""},"2013-06-01":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u513f\u7ae5\u8282",info:""},"2013-06-12":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u7aef\u5348\u8282",info:""},"2013-09-10":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u6559\u5e08\u8282",info:""},"2013-09-19":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u4e2d\u79cb\u8282",info:""},"2013-10-01":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u56fd\u5e86\u8282",
info:""},"2013-12-25":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u5723\u8bde\u8282",info:""},"2014-01-01":{afterTime:3,beforeTime:3,dayindex:0,holidayName:"\u5143\u65e6\u8282",info:""}},g=l.merge(g,c.config.infoData),f=["\u4eca\u5929","\u660e\u5929","\u540e\u5929"],r=["\u65e5","\u4e00","\u4e8c","\u4e09","\u56db","\u4e94","\u516d"],i={week:"\u5468",day:"\u5929",before:"\u524d",after:"\u540e"},j={SECOND:"\u79d2",MILLISECOND:"\u6beb\u79d2",MINUTE:"\u5206\u949f",HOUR:"\u5c0f\u65f6",DAY:"\u5929",
YEAR:"\u5e74"},d=null,h=null;return{isHoliday:function(a){return!!g[a]},parseTimeToNL_et:function(a){a>=864E5&&(a=864E5);return this.parseTimeToNL(a)},parseTimeToNL:function(a){var n="";return n=a<1E3?a+j.MILLISECOND:a<6E4?parseInt(a/1E3)+j.SECOND:a<36E5?parseInt(a/6E4)+j.MINUTE:a<864E5?parseInt(a/36E5)+j.HOUR:a<31536E6?parseInt(a/864E5)+j.DAY:parseInt(a/31536E6)+j.YEAR},plus:function(a,n){return new Date(a.getTime()+n*864E5)},today:function(){if(d)return d;var a=c.config.today.split("-"),a=c.config.today==
""?new Date:new Date(a[0],a[1]-1,a[2]);return d=new Date(a.getFullYear(),a.getMonth(),a.getDate())},parse:function(a){a=a.split("-");return new Date(a[0],a[1]-1,a[2])},format:function(a){typeof a=="number"&&(a=new Date(a));return a.getFullYear()+"-"+this.convert2digit(a.getMonth()+1)+"-"+this.convert2digit(a.getDate())},convert2digit:function(a){return a<10?"0"+a:a},compareDate:function(a,n){return a.getTime()-n.getTime()},getFirstDaysOfMonth:function(a){return new Date(a.getFullYear(),a.getMonth(),
1)},getLastDaysOfMonth:function(a){return new Date(a.getFullYear(),a.getMonth()+1,0)},getDateTip:function(a){var n=this.parse(a),b=(n.getTime()-this.today().getTime())/1E3/3600/24,m="";if(b<3){if(m={afterTime:3,beforeTime:3,dayindex:0,holidayName:f[b],info:""},this.isHoliday(a)&&(m=g[a]),m.holidayName==void 0)m.holidayName=i.week+r[n.getDay()]}else if(this.initDataTable(),h[a]){if(h[a].holidayName==void 0)h[a].holidayName=i.week+r[n.getDay()];if(h[a].info==void 0)h[a].info="";m=h[a]}m==""&&(m={afterTime:3,
beforeTime:3,dayindex:0,holidayName:i.week+r[n.getDay()],info:""});return m},getDateholidayName:function(a){var n=this.parse(a),b=(n.getTime()-this.today().getTime())/1E3/3600/24,m="";if(b<3)m=f[b],this.isHoliday(a)&&(m=g[a].holidayName);else if(this.initDataTable(),h[a])m=h[a].holidayName;m==""&&(m=i.week+r[n.getDay()]);return m},initDataTable:function(){if(h!=null)return h;h={};for(var a in g){var n=a,b=g[a];h[a]=b;if(b.beforeTime>0)for(var m=1;m<=b.beforeTime;m++){var e={},c=new Date(this.parse(n).getTime()-
m*864E5),f=this.format(c);e.holidayName=b.holidayName+i.before+m+i.day;e.dayindex=b.dayindex;h[f]?b.dayindex>h[f].dayindex&&h[f].beforeTime==null&&(h[f]=e):h[f]=e}if(b.afterTime>0)for(m=1;m<=b.afterTime;m++)e={},f=this.format(new Date(this.parse(n).getTime()+m*864E5)),e.holidayName=b.holidayName+i.after+m+i.day,e.dayindex=b.dayindex,h[f]?b.dayindex>h[f].dayindex&&h[this.format(new Date(c))].afterTime==null&&(h[f]=e):h[f]=e}}}}function x(g){for(var f=[],g=parseInt(g),c=0;c<=14;c++)f.push('<dd dt="'+
(g-c)+'-1-1">'+(g-c)+"</dd>");return f.join("")}function y(g,f,r,i){this.panel=g;var k=this;c.DateStyle.top=this.panel.offset().top+this.panel.height()-v(this.panel).top;c.DateStyle.left=this.panel.offset().left-v(this.panel).left;o.objpen=this.panel;l.isFunction(d.start)&&d.start(o);this.render=function(g,h,a,n){h=h||f.getMin();a=a||f.getMax();if(n)h=f.date1,a=f.getMax2(h,a);var b=(new C).set('<div class="popPanel" style="display: blick;">').set('<div class="dpanel">'),m=0;$.each([0],function(n,
c){var e=new Date(g.getFullYear(),g.getMonth()+n,1),i=e.getMonth()+1,r=j.convert2digit(i),d=e.getFullYear(),k=new Date(d,e.getMonth(),0),l=new Date(d,e.getMonth(),1),o=new Date(d,e.getMonth()+1,1),e=(new Date(d,i-1,1)).getDay();e<=0&&(e=0);var t=(new Date(d,i,0)).getDate();c==0?(h.getTime(),k.getTime()):(o.getTime(),a.getTime());b.set('<div class="dpart dbg'+i+'">');b.set("<h3>");b.set('<span class="but '+(c?"downTd":"upTd")+'" dt="'+j.format(c?l:k)+'" style="display:block"></span>');b.set('<span class="butm">'+
d+"\u5e74"+i+"\u6708</span>");b.set('<span dt="'+j.format(o)+'" class="but downTd"></span></h3>');b.set('<table cellspacing="0" cellpadding="0" border="0">');b.set('<tr class="thead"><td class="holi">\u65e5</td><td>\u4e00</td><td>\u4e8c</td><td>\u4e09</td><td>\u56db</td><td>\u4e94</td><td class="holi">\u516d</td></tr>');for(l=k=0;l<42;l++){l%7==0&&b.set('<tr class="tdate">');if(l<e)b.set('<td class="cnone">&nbsp;</td>');else if(k<t){k++;var o=j.convert2digit(k),o=d+"-"+r+"-"+o,u=new Date(d,i-1,k);
b.set('<td id="'+m++ +'" value="'+o+'" class="'+f.getTdStyle(u,h,a)+'" >'+k+"</td>")}else b.set('<td class="cnone">&nbsp;</td>');l%7==6&&b.set("</tr>")}b.set("</table>")});var e=g.getFullYear();b.set('<div class="styear"><dl><dt class="sy" dt="'+e+'-1-1"></dt><dd class="sl"><dl>');b.set(x(e));b.set('</dl></dd><dt class="ey" dt="'+e+'-1-1"></dt></dl></div></div>');b.set("</div>").set('<div class="tips" style="position:absolute;display:none;z-index:'+(c.DateStyle.zIndex+1)+'"></div></div>');_tt=this;
_tp=this.panel.next();_tp.html(b.get()).css(c.DateStyle);_tp.find(".but").click(function(){k.render(j.parse(this.getAttribute("dt")),h,a);o.t=_tt.panel;o.month=j.parse(this.getAttribute("dt"));l.isFunction(d.clickMonth)&&d.clickMonth(o)});_tp.find(".close").click(function(){_tp.hide()});_tp.find(".butm").click(function(){_tp.find("table").hide();_tp.find(".styear").show()});_tp.find("dd").click(function(){k.render(j.parse(this.getAttribute("dt")),h,a)});_tp.find("dt").click(function(){if($(this).hasClass("sy")){var b=
(new Date).getFullYear(),b=b-e<14?14:b-e;e=mxcsT=e-b}else b=(new Date).getFullYear(),b=b-e>14?14:b-e,e=mxcsT=e+b;_tp.find(".sl").html(x(mxcsT));_tp.find("dd").click(function(){k.render(j.parse(this.getAttribute("dt")),h,a)})});var t=_tp.find("div.dpanel").unbind().click(function(a){var b=a.target;if(b.nodeName=="TD"&&!l.inString("out",b.className," ")&&!l.inString("cnone",b.className," ")&&(a=b.getAttribute("value"),a!=null))i(b,r,a,n),b=j.parse(a),k.render(b),_tt.panel.val(a),_tt.panel.next().hide(),
o.Tip=j.getDateTip(a),o.t=_tt.panel,l.isFunction(d.clickend)&&d.clickend(o),l.isFunction(d.ending)&&d.ending(o)});if(c.config.info){var u=t.next();t.find("td").hover(function(){var a=$(this),b=a.attr("value");if(b!=void 0&&!a.hasClass("out")&&(b=j.getDateTip(b),b!=void 0)){var e=a.offset().top+a.height()-v(a).top,a=a.offset().left-v(a).left;u.css({top:e,left:a}).show().html("<p>"+b.holidayName+"</p><p>"+b.info+"</p>")}},function(){u.hide()})}o.pen=t;o.dk=s;l.isFunction(d.start)&&d.start()}}function v(c){var f=
0,d=0;c.parents().each(function(){if($(this).css("position")=="absolute"||$(this).css("position")=="relative")f=f||parseInt($(this).offset().top),d=d||parseInt($(this).offset().left)});return{top:f,left:d}}function C(){this._content_=[];this.set=function(){for(var c=this._content_,f=0;f<arguments.length;f++)c.push(arguments[f]);return this};this.get=function(){return this._content_.join("")}}function z(c,f,d){f?s.setDate2(d):s.setDate1(d)}var c=this;c.config=l.merge(D,B);c.DateStyle=l.merge(E,c.config.DateStyle);
var w=$(c.config.panels),F=$(A);w.find(c.config.did2);var d={start:c.config.start,ending:c.config.ending},j=new p,s=new function(g,f,d){var g=g||20,f=f==void 0?1:f,d=d==void 0?1:d,i=new p,j=i.today(),k=new Date(j.getTime()+g*864E5),h=new Date(j.getTime()+f*864E5);this.date1=h;this.setDate1=function(a){return this.date1=this.checkDate1(a).recommendDate};this.getDate1=function(){return i.format(this.date1)};this.date2=new Date(h.getTime()+d*864E5);this.setDate2=function(a,c){return this.date2=this.checkDate2(a,
i.format(this.date1),c).recommendDate};this.getDate2=function(){return i.format(this.date2)};this.checkDate1=function(a){return this.checkDate(a,j,k,h)};this.checkDate2=function(a,c,b){c=k;b&&(c=i.parse(b));b=new Date(this.date1.getTime()+d*864E5);b.getTime()>c.getTime()&&(b=c);return this.checkDate(a,this.date1,c,b)};this.checkDate=function(a,c,b,d){var e=null,g=!1,f=null,h="";try{e=i.parse(a)}catch(j){g=!0,f="\u683c\u5f0f\u9519\u8bef",h="\u65e5\u671f\u683c\u5f0f\u5982: "+i.format(d),e=d}isNaN(e)?
(g=!0,f="\u683c\u5f0f\u9519\u8bef",h="\u65e5\u671f\u683c\u5f0f\u5982: "+i.format(d),e=d):c.getTime()>e.getTime()?(g=!0,f="\u8d85\u51fa\u8303\u56f4",h="\u5e94\u9009\u62e9"+i.format(c)+"\u81f3"+i.format(b)+"\u4e4b\u95f4\u7684\u65e5\u671f",e=d):e.getTime()>b.getTime()&&(g=!0,f="\u8d85\u51fa\u8303\u56f4",h="\u5e94\u9009\u62e9"+i.format(c)+"\u81f3"+i.format(b)+"\u4e4b\u95f4\u7684\u65e5\u671f",e=d);return{error:g,recommend:i.format(e),recommendDate:e,value:f,tip:h}};this.getMin=function(){return j};this.getMax=
function(){return k};this.getMax2=function(a,c){return new Date(a.getTime()+c*864E5)};this.resetMax=function(a,c){var b=c||g;k=new Date((a||j).getTime()+b*864E5)};this.setSpan=function(a){g=a};this.marks={};this.date2Hide=!1;this.hideDate2=function(){this.date2Hide=!0};this.showDate2=function(){this.date2Hide=!1};this.getTdStyle=function(a){var d=a.getTime(),b="";d==this.date1.getTime()?b+=" curr":d==this.date2.getTime()&&this.date2Hide==!1&&(b+=" othr");if(a.getDay()==0||a.getDay()==6||i.isHoliday(i.format(a)))b+=
" holi";d==j.getTime()&&(b+=" today");if(c.config.CustomData!=null){for(var a=i.format(a),d=c.config.CustomData,g=0,e=0;e<=d.length;e++)if(a==d[e]){g=1;break}b=g?b:"out"}return b}}(c.config.maxTag,c.config.interval,c.config.tointerval),o={t:c,config:c.config,DateStyle:c.DateStyle},k=F.after('<div class="hubsDate"></div>');k.attr("readonly",!0);k.click(function(){var c=this.value!=""?j.parse(this.value):j.today();(new y(k,s,0,z)).render(c);k.next().show();l.isFunction(d.start)&&d.start()});c.config.dids[0]&&
c.config.dids[0].click(function(){var c=k.val()!=""?j.parse(k.val()):j.today();(new y(k,s,0,z)).render(c);k.next().show()});c.config.render&&(w=j.format(s.date1),s.setDate1(w),k.val(w),c.config.showf[0]&&c.config.showf[0].text(j.getDateTip(j.format(s.date1)).holidayName));$(document).click(function(g){g=$(g.target);!g.parents(".dpart")[0]&&g[0]!=k[0]&&c.config.dids[0]==""&&g[0]!=c.config.dids[0][0]&&!g.hasClass("but")&&!g.is("dd")&&(k.next().hide(),$.browser.msie&&$.browser.version=="6.0"&&(g.is("input")||
l.isFunction(d.ending)&&d.ending(o)))})}var D={panels:"#hdate",did1:".hdate1",did2:".hdate2",maxTag:361,maxDay:14,today:"",render:!1,interval:0,tointerval:0,readonly:!0,info:!0,infoData:null,DateStyle:{},CustomData:null,start:function(){$.browser.msie&&$.browser.version=="6.0"&&$("select").css("visibility","hidden")},ending:function(){$.browser.msie&&$.browser.version=="6.0"&&$("select").css("visibility","inherit")},showf:["",""],dids:["",""]},E={clear:"both",position:"absolute",zIndex:999999,top:"",
left:""};l.augment(p,{getDate:function(){return{date1:dk.getDate1(),date2:dk.getDate2()}},on:function(l,p){_onVal[l]=p},setCustomData:function(l){_t.config.CustomData=l},render:function(){af1&&dk.setDate1(af1.val());af2&&dk.setDate2(af2.val())},news:function(l,p){af1&&af1.val(l||dk.getDate1());af2&&af2.val(p||dk.getDate2());this.render();_t.config.showf[0]&&_t.config.showf[0].text(q.getDateTip(q.format(dk.date1)).holidayName);_t.config.showf[1]&&_t.config.showf[1].text(q.getDateTip(q.format(dk.date2)).holidayName)}});
return p});
