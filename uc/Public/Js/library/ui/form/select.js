BQ.add("ui.form.Select",function(i){function v(b){var a=[];$.each(b,function(b,d){var f=[];"value"in d||(d.value=d.text);for(var c in d)c!="text"&&f.push(c+'="'+d[c]+'"');a.push("<option "+f.join(" ")+">"+d.text+"</option>")});return a=a.join("")}function A(b){var a=[],h="";if(/[\s]+/i.test(b)){var a=b.split(" "),d;for(d in a)h+=s+a[d]}else h=s+b;return h}function x(b,a,h){var d=b.listItemCls,b=b.listTemplate,f=h.length,c=[];$.each(h,function(a){var b=y+a;a===0&&d[0]&&(b=d[0]);a===f-1&&d[1]&&(b=d[1]);
c.push({text:h[a].text,value:h[a].value,cls:b})});if(i.isUndefined(b))$.each(c,function(b,c){b===0&&d[0]?a.push('<li class="'+d[0]+'">'+c.text+"</li>"):b===f-1&&d[1]?a.push('<li class="'+d[1]+'">'+c.text+"</li>"):a.push("<li>"+c.text+"</li>")});else{var m=self.parseObj||(self.parseObj=function(a){a=a.replace(w,"'+data[\"$1\"]+'");return new Function("data",["return '",a,"';"].join(""))}(b));$.each(c,function(b,c){a[b]=m(c)})}}function t(b,a){function h(a,b){var c=f.ulSelector,b=b||"";c.removeClass("over").removeClass("current");
a.css({"z-index":b});c.hide()}function d(a,b,c,d){a=a.find("li").eq(d);b[0].selectedIndex=d;b.change();a.toggleClass("over");c.html(a.html())}if(!(this instanceof t))return new t(b,i.merge(z,a));var f=this;f.config=a;f.container=$(b);z.optionsCache={};var c=f.container,m,q=(c[0].id||c[0].name)+B,w=$.browser.mozilla?"DOMMouseScroll":"mousewheel",u=[],j;m="";var k,g,l,r,o;if(!i.isUndefined(a.name)&&!i.isUndefined(a.options))u=a.name in a.optionsCache?v(a.optionsCache[a.name]):v(a.options),a.optionsCache[a.name]=
a.options;c.is("select")?c.before('<div id="'+q+'" class="'+a.containerCls+'" tabindex="0"></div>').prependTo($("#"+q)):$.trim(c.html())===""&&(m='<select id="'+c[0].id+'" name="'+c[0].id+'">'+u+"</select>",c.append(m).attr("id",q).attr("class",a.containerCls));g=c[0].nodeName.toLowerCase()!=="select"?c:c.parent();l=c[0].nodeName.toLowerCase()!=="select"?c.children():c;r=l[0].options[l[0].selectedIndex];if(i.isUndefined(a.domTemplate)&&i.isUndefined(a.listTemplate)){if(i.isUndefined(a.titleElm))a.titleElm=
"h4";c=a.titleCls;m=a.listCls;q=i.isUndefined(c)?"":' class="'+c+'"';u=i.isUndefined(m)?"":' class="'+m+'"';m="<"+a.titleElm+q+"></"+a.titleElm+">";a.domTemplate='<div class="'+a.selectCls+'">'+m+"<ul"+u+"></ul></div>";c=A(c);c=i.isUndefined(c)?a.titleElm:c}else c=C,m=y,c=s+c,k=s+m;k=i.isUndefined(k)?"ul":k;g.append(a.domTemplate);j=g.find(c);j.empty().append(r.text);f.titleSelector=j;var e=l.find("option").index(r),n=g.find(k),p;f.ulSelector=n;!i.isUndefined(j)&&j.is("button")&&j.click(function(a){a.preventDefault()});
if(i.isUndefined(a.disableWidth)||a.disableWidth===!1)k=l.width(),$.browser.safari&&(k+=15),j.css({width:k}),k=k+parseInt(j.css("padding-left"),10)+parseInt(j.css("padding-right"),10),f.ulSelector.css({width:k+"px"});l.hide();(function(){var b=f.container,c=[],d=b.find("option");x(a,c,d);c=c.join("");b[0].nodeName.toLowerCase()!=="select"||b.parent();b[0].nodeName.toLowerCase()!=="select"&&b.children();n.html(c)})();p=g.find("li");i.isUndefined(a.listItemCount)||(o=parseInt(p.css("height"))*a.listItemCount,
k=parseInt(p.css("height"))*p.size(),o<=k?n.css("height",o+"px"):o>k&&n.css("height",k+"px"),n.css("overflow","auto"),n.bind("scroll",function(){p.focus()}));g.bind({click:function(){var b=f.ulSelector,c=$(this).find("li");b.css("display")=="block"?h(g):(j.addClass("current"),b.show(),g.css({position:"relative"}),c.hover(function(){c.removeClass(a.hoverCls);$(this).addClass(a.hoverCls).addClass(a.selectedItemCls)},function(){$(this).removeClass(a.hoverCls)}));b.bind("click",function(a){for(var b=
$(a.target),i=b.html(),j=c.length;j--;)c.eq(j).html().indexOf(i)>-1&&(e=j);e===-1&&(e=b.index());r=l[0].options[e];d(g,l,f.titleSelector,e);f.titleSelector.html(r.text);a.stopPropagation();a.cancelbubble=!0;h(g)});return!1},dblclick:function(){h(g);return!1},keydown:function(a){var b=g.find(".over"),c=l.find("option").length,f=n.scrollTop();$(this).bind("keydown",function(a){if(a.keyCode==40||a.keyCode==38||a.keyCode==35||a.keyCode==36)return!1});switch(a.keyCode){case 9:return!0;case 13:h(g);break;
case 27:h(g);break;case 33:b.removeClass("over");e=0;d(g,l,j,e);break;case 34:b.removeClass("over");e=c-1;d(g,l,j,e);break;case 35:b.removeClass("over");e=c-1;d(g,l,j,e);break;case 36:b.removeClass("over");e=0;d(g,l,j,e);break;case 38:if((!i.isUndefined(o)||o!==0)&&f>0)n[0].scrollTop=f-parseInt(p.css("height"));a.preventDefault();b.removeClass("over");e===0?e=0:e-=1;d(g,l,j,e);break;case 40:if(!i.isUndefined(o)||o!==0){var k=p.height()*p.size();if(f+o<k)n[0].scrollTop=f+parseInt(p.css("height"))}a.preventDefault();
b.removeClass("over");e===c-1?e=c-1:e+=1;d(g,l,j,e);break;default:a.preventDefault()}},blur:function(){h(g);return!1},selectstart:function(){return!1}}).bind(w,function(a){var b=0,c,b=a.wheelDelta?a.wheelDelta/120:-a.detail/3,a=g.find(".over");c=l.find("option").length;b>0?(a.removeClass("over"),e===0?e=0:e-=1):(a.removeClass("over"),e===c-1?e=c-1:e+=1);d(g,l,j,e)});$("body").bind("click",function(){n.each(function(){$(this).css("display")!="none"&&$(this).hide()})})}var s=".",B="-select-bar",C="Select-title",
y="Select-List",w=/\\?\%([^%]+)\%/g,z={listItemCls:["first","last"],disableWidth:!0,containerCls:"dropdown_container",selectCls:"dropdown_select_box",titleCls:"pretend_select",listCls:"locat_select",hoverCls:"over",selectedItemCls:"selectedli"};i.augment(t,{on:function(b,a){this.container.bind(b,function(b,d){b.preventDefault();a.call(b,d)})},getProperty:function(b){var a=this.container;return b==="text"?$(a[0].options[a[0].selectedIndex]).html():a[0][b]},val:function(){var b=this.container;return b[0].value!==
""?b[0].value:b[0].text},setDefalutVal:function(b){this.container[0].defaultValue=b;this.titleSelector.html(b)},upList:function(b,a){var h,d=[],f=this.container;h=this.config;i.isArray(b)&&(a=b,b="aaa");i.isUndefined(a)?a=h.optionsCache[b]:h.optionsCache[b]=a;x(h,d,a);h=v(a);f.empty().append(h);d=d.join("");this.ulSelector.html(d);this.titleSelector.html($("option:eq(0)",f).text())}});return t});
