BQ.add("ui.form.Validate",function(l){function g(b,c){var d=this;if(!(d instanceof g))return new g(b,l.merge(o,c));String.prototype.reTrim=function(){return this.replace(/^#/,"")};d.config=c;d.container=b;d.txt="";var a=$(b),e=null;if(a.first().data("vExample"))return!1;a.first().data("vExample",!0);d.k={1:"isEmpty",2:"lenMin",3:"lenMax",4:"lenRange",5:"isEmail",6:"isPhone",7:"isTell",8:"isChinese",9:"isEqual",10:"isRadio"};d.v={isEmpty:function(){return!!$.trim(d.txt)},lenMin:function(a){return d.txt.length>=
~~a.p},lenMax:function(a){return d.txt.length<=~~a.p},lenRange:function(a){var a=a.p.split(":"),b=d.txt.length;return b>=~~a[0]&&b<=~~a[1]},isEmail:function(){return/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/.test(d.txt)},isPhone:function(){return/^\d{3,4}-\d{7,8}(-\d{3,4})?$/.test(d.txt)},isTell:function(a){a=a.p;return RegExp("^("+a+")\\d{"+(11-a.split("|")[0].length)+"}$").test(d.txt)},isChinese:function(){return/^[\u4E00-\u9FA5\uf900-\ufa2d]+$/.test(d.txt)},isEqual:function(a){a=a.p.split(":");
return $(a[0]).val()===$(a[1]).val()},isRadio:function(){return!!$(b).filter(":checked").get(0)}};d.showTip=function(h){h=h?h:c.TipMsg;id="#validateTip_"+b.match(/\w+/g).join("");var i=(c.TipTemplete?c.TipTemplete:'<div id="%id%" class="cls"><img alt="" src="img/tip.jpg" /><span class="sp msg"></span></div>').replace("%id%",id.reTrim());$(document.body).has(id).length||(c.FixedContainer?$(c.FixedContainer).append(i):$(document.body).append(i));e=$(id);if(!c.FixedContainer){a=a.last();var j=c.Position,
f=a.offset(),i=f.top+a.height()+j[1],j=f.left+a.width()+j[0];e.css({top:i,left:j})}c.showBack[0]&&c.showBack[0].call(d);$(e).fadeIn("fast",function(){c.showBack[1]&&c.showBack[1].call(d)}).find(".msg").html(h);a.css("border-color","#f00")};d.bool=function(a,b){var c=b.replace(/^:+|:+$/g,"").split(":"),a=$.parseJSON(a);$.each(c,function(b,c){c in a&&(a=a[c])});return!!a};c.AutoValidate&&a.bind(c.eventShow,function(){d.validate()});a.bind(c.eventHide,function(){$(e).filter(":hidden").length||($(e).fadeOut("fast"),
a.css("border-color",""))});if(c.validateForm){var f=$(a).parents("form").first(),m=f.data("formArray"),k=m?m:[];k.push(d);var n=f.data("events")==void 0?null:f.data("events").submit[0].handler;f.data("formArray",k);f.unbind("submit").bind("submit",function(){var a=!0;$.each(k,function(b,c){c.validate()||(a=!1)});a&&n&&n.call(this);return a})}}var o={TipMsg:"\u8be5\u8f93\u5165\u9879\u4e3a\u5fc5\u8f93\u9879",eventShow:"blur",eventHide:"keyup",Position:[20,0],Text:null,AutoValidate:!0,FixedContainer:"",
TipTemplete:"",validateType:[1,{k:2,p:"5",msg:"\u63d0\u793a\u4fe1\u606f",fail:null,success:null,Ajax:{open:!1,url:"",para:null,step:""},self:null},function(){}],validateForm:!1,showBack:[0,0]};l.augment(g,{validate:function(){var b=this,c=!0;b.txt=b.config.Text?b.config.Text.call(b):$(b.container).val();$.each(b.config.validateType,function(d,a){if(a.Ajax&&a.Ajax.open){var e=$.ajax({type:"get",url:a.Ajax.url,data:a.Ajax.para,async:!1}).responseText;if(!(typeof e=="boolean"?e:b.bool(e,a.Ajax.step)))return b.showTip(a.msg),
a.fail&&a.fail.call(b),c=!1}else if(typeof a=="function"||a.self){if(!(typeof a=="function"?a:a.self).call(b,b.container))return b.showTip(a.msg),a.fail&&a.fail.call(b),c=!1}else if(e=Object.prototype.toString.call(a).indexOf("Object")>-1?a.k:a,!b.v[typeof e=="string"?e:b.k[e]](a))return b.showTip(a.msg),a.fail&&a.fail.call(b),c=!1;a.success&&a.success.call(b)});return c}});return g});
