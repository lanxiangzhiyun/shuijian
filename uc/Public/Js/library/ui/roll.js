BQ.add("ui.Roll",function(g){function f(b,c,e,d){var a=this;if(!(a instanceof f))return new f(b,c,e,g.merge(h,d));a.Bar=$(e);a.Container=$(c);a.scrollObj=$(b);a.scrollChild=$(d.childs,a.scrollObj);a._timer=null;a._ondrag=!1;a._IsMin=a._IsMax=a._IsMid=!1;a._drag=BQ.ui.Drag(a.Bar,{Limit:!0,mxContainer:a.Container[a.Container.length-1],onStart:a.Binds(a,a.DragStart),onStop:a.Binds(a,a.DragStop),onMove:a.Binds(a,a.Move)});a.WheelSpeed=Math.max(0,d.WheelSpeed);a.KeySpeed=Math.max(0,d.KeySpeed);a.MinValue=
d.MinValue;a.RunTime=Math.max(1,d.RunTime);a.RunStep=Math.max(1,d.RunStep);a.Ease=!!d.Ease;a.EaseStep=Math.max(1,d.EaseStep);a.onMin=d.onMin;a.onMax=d.onMax;a.onMid=d.onMid;a.onDragStart=d.onDragStart;a.onDragStop=d.onDragStop;a.onMove=d.onMove;a._horizontal=!!d.Horizontal;a._drag[a._horizontal?"LockY":"LockX"]=!0;if(a._horizontal&&a.scrollChild)a.scrollChild.css("float","left"),b=a.scrollChild.eq(0),b=b.outerWidth()+parseInt(b.css("marginLeft"))+parseInt(b.css("marginRight")),c=a.scrollChild.length,
a.scrollChild.parent().width(b*c);a._MaxValue=d.MaxValue;a.MaxValue=a._horizontal?a.scrollObj[0].scrollWidth-a.scrollObj[0].clientWidth:a.scrollObj[0].scrollHeight-a.scrollObj[0].clientHeight;a.Container.bind("click",a.Binds(a,function(b){a._ondrag||a.clickCtrl(b)}));a.Bar.bind("click",function(a){a.stopPropagation()});a.keyBind(a.Container);var i=$.browser.msie?a.Bar:a.Container;a.Bar.bind("mousedown",function(){i[0].focus()});a.WheelBind(a.Container);d.upOrLeft&&$(d.upOrLeft)&&$(d.upOrLeft).bind({mousedown:a.Binds(a,
function(b){b.preventDefault();a.run(!1)}),mouseup:a.Binds(a,function(b){b.preventDefault();a.stop()})});d.downOrRig&&$(d.downOrRig)&&$(d.downOrRig).bind({mousedown:a.Binds(a,function(b){b.preventDefault();a.run(!0)}),mouseup:a.Binds(a,function(b){b.preventDefault();a.stop()})})}var h={childs:"li",upOrLeft:null,downOrRig:null,MinValue:0,MaxValue:100,WheelSpeed:5,KeySpeed:50,Horizontal:!0,RunTime:20,RunStep:2,Ease:!1,EaseStep:5,onMin:function(){},onMax:function(){},onMid:function(){},onDragStart:function(){},
onDragStop:function(){},onMove:function(){}};g.augment(f,{Binds:function(b,c){var e=Array.prototype.slice.call(arguments,2);return function(){return c.apply(b,e.concat(Array.prototype.slice.call(arguments)))}},DragStart:function(){this.stop();this.onDragStart();this._ondrag=!0},DragStop:function(){this.onDragStop();setTimeout(this.Binds(this,function(){this._ondrag=!1}),10)},Move:function(){var b=this.getPercent();this._horizontal?this.scrollObj[0].scrollLeft=this.getValue():this.scrollObj[0].scrollTop=
this.getValue();this.onMove();if(b>0)this._IsMin=!1;else if(!this._IsMin)this._IsMin=!0,this.onMin();if(b<1)this._IsMax=!1;else if(!this._IsMax)this._IsMax=!0,this.onMax();if(b>0&&b<1){if(!this._IsMid)this._IsMid=!0,this.onMid()}else this._IsMid=!1},getPercent:function(){return this._horizontal?this.Bar[0].offsetLeft/(this.Container[this.Container.length-1].clientWidth-this.Bar[0].offsetWidth):this.Bar[0].offsetTop/(this.Container[this.Container.length-1].clientHeight-this.Bar[0].offsetHeight)},setPercent:function(b){this.easePos((this.Container[this.Container.length-
1].clientWidth-this.Bar[0].offsetWidth)*b,(this.Container[0].clientHeight-this.Bar[0].offsetHeight)*b)},getValue:function(){return this.MinValue+this.getPercent()*(this.MaxValue-this.MinValue)},setValue:function(b){this.setPercent((b-this.MinValue)/(this.MaxValue-this.MinValue))},clickCtrl:function(b){for(var c=this.Container[this.Container.length-1],e=c.offsetLeft,d=c.offsetTop;c.offsetParent;)c=c.offsetParent,e+=c.offsetLeft,d+=c.offsetTop;this.easePos(b.pageX-e-this.Bar[0].offsetWidth/2,b.pageY-
d-this.Bar[0].offsetHeight/2)},keyBind:function(b){b.bind("keydown",this.Binds(this,this.keyCtrl));b[b.length-1].tabIndex=-1;b.css("outline","none")},keyCtrl:function(b){if(this.KeySpeed){var c=this.Bar[0].offsetLeft,e=this.Bar[0].offsetTop,d=(this.Container[this.Container.length-1].clientWidth-this.Bar[0].offsetWidth)/this.KeySpeed,a=(this.Container[this.Container.length-1].clientHeight-this.Bar[0].offsetHeight)/this.KeySpeed;switch(b.keyCode){case 37:c-=d;break;case 38:e-=a;break;case 39:c+=d;break;
case 40:e+=a;break;default:return}this.setPos(c,e);b.preventDefault()}},WheelBind:function(){document.addEventListener&&this.Container.bind("DOMMouseScroll",this.Binds(this,this.WheelCtrl));this.Container.bind("mousewheel",this.Binds(this,this.WheelCtrl))},WheelCtrl:function(b){var c;b.wheelDelta?c=this.WheelSpeed*(b.wheelDelta/-40):b.detail&&(c=this.WheelSpeed*b.detail);this.setPos(this.Bar[0].offsetLeft+c,this.Bar[0].offsetTop+c);b.preventDefault()},easePos:function(b,c){this.stop();b=Math.round(b);
c=Math.round(c);if(this.Ease){var e=this.Bar[0].offsetLeft,d=this.getStep(b,e),a=this.Bar[0].offsetTop,f=this.getStep(c,a);if(this._horizontal?d:f)if(this.setPos(e+d,a+f),this._IsMid)this._timer=setTimeout(this.Binds(this,this.easePos,b,c),this.RunTime)}else this.setPos(b,c)},getStep:function(b,c){var e=(b-c)/this.EaseStep;if(e==0)return 0;Math.abs(e)<1&&(e=e>0?1:-1);return e},run:function(b){this.stop();var c=this.getPercent()+(b?1:-1)*this.RunStep/100;this.setPos((this.Container[this.Container.length-
1].clientWidth-this.Bar[0].offsetWidth)*c,(this.Container[this.Container.length-1].clientHeight-this.Bar[0].offsetHeight)*c);if(!(b?this._IsMax:this._IsMin))this._timer=setTimeout(this.Binds(this,this.run,b),this.RunTime)},setPos:function(b,c){this.stop();b=Math.min(this.Container[this.Container.length-1].clientWidth-this.Bar[0].clientWidth,b);this._drag.setPosition(b,c)},stop:function(){this._timer&&clearTimeout(this._timer)}});return f});
