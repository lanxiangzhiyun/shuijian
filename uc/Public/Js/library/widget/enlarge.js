BQ.add("widget.Enlarge",function(s){function p(b,d){function f(){var a=g.find("img"),b=a.width();a.height();l=t[c];h.children().remove();h.append(l);h.show();l.width()/b<d.limitMultiple||l.height()<d.limitMultiple?q=!1:(q=!0,m=parseInt(l.width())/parseInt(g.find("img").width()),l.css({position:"absolute"}));h.hide()}if(!(this instanceof p))return new p(b,s.merge(u,d));b=$(b);b.outerWidth();b.height();b.offset();b.offset();b.offset();var t=[],g=null,m=3,j=null,n=null,h=null,l=null,r=!0,q=!0,c=0,o=
b.find(d.trigger),e=b.find(d.panels);this.container=b;o.each(function(a){$(this).attr("order",a);$(this).hasClass(d.activeCls)&&(c=a,g=e.eq(a))});e.css({position:"relative"});e.each(function(a){$(this).attr("order",a);a=new Image;a.src=$(this).find("img").attr("bsrc");t.push($(a))});o.length==0&&(g=e.eq(0));j=g.find("img").offset();$("<div></div>");h=$("<div></div>");$("body").append(h);h.css({width:d.width,height:d.height,border:"solid 3px #ddd",overflow:"hidden",background:"#fff",position:"absolute",
zIndex:9999,display:"none"});f();e.mousemove(function(a){if(q==!0){if(r==!0){r=!1;n=$("<div></div>");n.css({width:d.width/m,height:d.height/m,border:"solid 3px #bbb",position:"absolute",zIndex:9999,cursor:"move",background:"#fff",opacity:0.5});g.append(n);var c=b.outerWidth(),c=b.offset().left+c+3,e=b.offset().top;h.css({top:e,left:c})}h.show();var c=g,f=n,k=c.find("img"),e=k.height()-f.outerHeight(),f=k.width()-f.outerWidth(),k=a.pageX-j.left-d.width/m/2,a=a.pageY-j.top-d.height/m/2,i={area:{},bigImg:{}},
k=k>0?k:0,a=a>0?a:0;i.bigImg.left=k>f?f:k;i.bigImg.top=a>e?e:a;i.area.left=i.bigImg.left+j.left-c.offset().left;i.area.top=i.bigImg.top+j.top-c.offset().top;n.css({top:i.area.top,left:i.area.left});l.css({top:-i.bigImg.top*m,left:-i.bigImg.left*m})}});e.mouseleave(function(){q==!0&&(h.hide(),n.remove(),r=!0)});b.mouseenter(function(){j=g.find("img").offset();f()});d.eventType=="mouse"?o.mouseenter(function(){c=$(this).attr("order");g=e.eq(c);o.removeClass(d.activeCls).eq(c).addClass(d.activeCls);
e.hide().eq(c).show();j=g.find("img").offset();f();b.trigger("switch",c)}):o.click(function(a){a.stopPropagation();c=$(this).attr("order");g=e.eq(c);o.removeClass(d.activeCls).eq(c).addClass(d.activeCls);e.hide().eq(c).show();j=g.find("img").offset();f();b.trigger("switch",c)})}var u={trigger:".list li",panels:".show li",activeCls:"current",eventType:"mouse",width:360,height:360,limitMultiple:1.5,interval:3E3,speed:500,auto:!1,effect:"common"};s.augment(p,{on:function(b){this.container.bind("switch",
function(d,f){b(f)})}});return p});
