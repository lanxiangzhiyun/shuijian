BQ.add("widget.LayerBox",function(o){function z(g,b){o.each(b,function(b,o){g[o]=b})}function s(g,b){function l(e,h){function b(e){for(var c=0;c<e.length;c++){var i=e[c];if(i.nodeType==1){if(d==".")if(i.className.split(" ").length==1)i.className==h.split(".")[1]&&a.push(i);else for(var f=i.className.split(" "),g=0;g<f.length;g++)f[g]==h.split(".")[1]&&a.push(i);else d=="#"?i.getAttribute("id")==h.split("#")[1]&&a.push(i):i.tagName.toLowerCase()==h&&a.push(i);i.childNodes.length>=1&&b(i.childNodes)}}}
var c=e.childNodes,a=[],d=h.substr(0,1);b(c);return a}function B(e,a){for(var b=e.match(/\{[a-zA-Z]+\}/gi),c=0;c<b.length;c++)var d=b[c].replace(/[\{\}]/gi,""),e=e.replace(b[c],a[d]);return e}function A(){var e=n("div.layerbox_mask"+w);if(e.length)this.el=e[0];else{this.el=d.body.appendChild(d.createElement("DIV"));z(this.el.style,o.merge(C,{backgroundColor:b.backcolor,zIndex:b.zIndex,height:Math.max(d.documentElement.clientHeight,d.documentElement.scrollHeight)+"px",width:Math.max(d.documentElement.clientWidth,
d.documentElement.scrollWidth)+"px",opacity:b.opacity,filter:"alpha(opacity="+b.opacity*100+")",mozOpacity:b.opacity}));var a=this.el.style;r.addEvent(q,"resize",function(){a.height=Math.max(d.documentElement.clientHeight,d.documentElement.scrollHeight)+"px";a.width=Math.max(d.documentElement.clientWidth,d.documentElement.scrollWidth)+"px"});this.el.className="layerbox_mask"+w;if(j.version()==6)this.el.innerHTML='<iframe frameborder="no" style="width:100%;height:100%;display:block;filter:Alpha(opacity=0);"></iframe><div style="position:absolute;z-index:2;left:0;top:0;width:100%;height:100%;display:block;filter:Alpha(opacity=0);"></div>'}}
function k(){this.center=function(e){e.style.display="block";var a=e.offsetHeight,m=e.offsetWidth;e.style.display="none";var c=j.version()!=6?(d.documentElement.clientHeight-a)/2:(d.documentElement.clientHeight-a)/2+d.documentElement.scrollTop;e.style.top=(c<0?20+d.documentElement.scrollTop:c)+"px";e.style.left=(d.documentElement.clientWidth-m)/2+"px";e.style.position=b.scroll?"fixed":"absolute";e.style.zIndex=b.zIndex+1;b.scroll&&r.addEvent(q,"resize",function(){e.style.top=(j.version()!=6?(d.documentElement.clientHeight-
a)/2:(d.documentElement.clientHeight-a)/2+d.documentElement.scrollTop)+"px";e.style.left=(d.documentElement.clientWidth-m)/2+"px"});if(j.version()==6&&b.scroll)e.style.position="absolute",r.addEvent(q,"scroll",function(){e.style.top=(d.documentElement.clientHeight-a)/2+d.documentElement.scrollTop+"px"})}}function D(e){var a=d.documentElement,b=d.body,c=Math.max,f=d.compatMode=="CSS1Compat"?a:b;return{left:c(a.scrollLeft,b.scrollLeft),top:c(a.scrollTop,b.scrollTop),width:f[(e?"client":"scroll")+"Width"],
height:e?f.clientHeight:c(f.clientHeight,f.scrollHeight)}}function u(e,a){function m(a){a=a||q.event;l=a.clientX;i=a.clientY;j=p.offsetLeft;o=p.offsetTop;p.ondragstart=this.ondragstart=function(){return!1};d.onmousemove=c;e.setCapture&&e.setCapture();d.onlosecapture=q.onblur=d.onmouseup=f;a.preventDefault&&a.preventDefault()}function c(e){var e=e||q.event,a=o+e.clientY-i;g.style.left=j+e.clientX-l+"px";g.style.top=a+"px"}function f(){var a,c,b=p.offsetLeft,h=p.offsetTop,m=k.left+k.width-p.offsetWidth,
d=k.top+k.height-p.offsetHeight;h<0&&(t2=0,c=!0);b<0&&(t=0,a=!0);b>m&&(t=m,a=!0);h+k.top>d&&(t2=d-k.top,c=!0);if(c||a){if(a)p.style.left=t+"px";if(c)p.style.top=t2+"px"}q.onblur=this.onmouseup=this.onmousemove=null;e.releaseCapture&&e.releaseCapture()}var g=a,p=a||e,l,i,j,o,k;k=D(!0);if(e.length!=void 0)for(var n=0;n<e.length;n++)e[n].onmousedown=m,e[n].style.cursor=b.diagCursor;else e.onmousedown=m,e.style.cursor=b.diagCursor}function x(){this.al=d.body.appendChild(d.createElement("DIV"));this.al.className=
"layerbox_dialog_alert"+w;z(this.al.style,o.merge({position:"absolute",width:b.width+"px",height:b.height+"px",zIndex:b.zIndex+1,display:"none",backgroundColor:"#FFF",fontSize:"12px",border:"2px solid #d8d8d8",textAlign:"center","float":"left"},b.alStyle));this.al.innerHTML=""}if(!(this instanceof s))return new s(g,o.merge(E,b));var b=this.config=b,d=!b.ParIframe?document:b.ParIframeMan.document,q=!b.ParIframe?window:b.ParIframeMan,w=Date.parse(new Date)+Math.floor(Math.random()*1E5),j={ie:function(){return!!window.ActiveXObject},
version:function(){if(window.ActiveXObject){var e=!!window.ActiveXObject,a=e&&!window.XMLHttpRequest,b=e&&!!document.documentMode;if(e)if(a)return"6.0";else if(b)return"8.0";else if(e&&!a&&!b)return"7.0"}}};if(!j.ie()){var y=window.HTMLElement.prototype;y.__defineGetter__("outerHTML",function(){for(var a="<"+this.tagName,b=this.attributes,d=0,c=b.length;d<c;d++)b[d].specified&&(a+=" "+b[d].name+'="'+b[d].value+'"');if(!this.canHaveChildren)return a+" />";return a+">"+this.innerHTML+"</"+this.tagName+
">"});y.__defineSetter__("outerHTML",function(a){var b=this.ownerDocument.createRange();b.setStartBefore(this);this.parentNode.replaceChild(b.createContextualFragment(a),this);return a});y.__defineGetter__("canHaveChildren",function(){return!/^(area|base|basefont|col|frame|hr|img|br|input|isindex|link|meta|param)$/.test(this.tagName.toLowerCase())})}var n=function(a,b){function m(){var a=this.i.split("#").length>1?this.i.split("#"):[null,this.i];return f.getElementById(a[1])}function c(){for(var a=
this.i.split(".").length>1?this.i.split("."):[null,this.i],b=[],e=f.getElementsByTagName(a[0]||"*"),c=0;c<e.length;c++)if(e[c].className.split(" ").length==1)e[c].className==a[1]&&b.push(e[c]);else for(var d=e[c].className.split(" "),h=0;h<d.length;h++)d[h]==a[1]&&b.push(e[c]);return b}var f=b==void 0?d:b;this.i=a;switch(a.substr(0,1)){case "#":return m();case ".":return c();default:return c()}},r={addEvent:d.addEventListener?function(a,b,d){a.addEventListener&&a.addEventListener(b,d,!1)}:function(a,
b,d){a.attachEvent&&a.attachEvent("on"+b,d)},removeEvent:d.removeEventListener?function(a,b,d){a.removeEventListener&&a.removeEventListener(b,d,!1)}:function(a,b,d){a.detachEvent&&a.detachEvent("on"+b,d)}},v=function(a,b){if(a.length!=void 0)for(var d=0;d<a.length;d++)r.addEvent(a[d],"click",function(a){a=a||event;!j.ie()?a.preventDefault():a.returnValue=!1;b()});else r.addEvent(a,"click",function(a){a=a||event;!j.ie()?a.preventDefault():a.returnValue=!1;b()})};A.prototype={show:function(){this.el.style.display=
"block"},hide:function(){this.el.style.display="none"}};x.prototype={show:function(){this.al.style.display="block"},hide:function(){this.al.style.display="none"}};var f=function(){this._close=this._mk=this.dialog=null};f.mask=function(){var a=null;b.isFrame&&(a=new A);this.mask_show=function(){a&&a.show()};this.mask_hide=function(){a&&a.hide()}};var a=new f;f.alert=function(e,d){function m(){a._mk.mask_hide();a.dialog.hide()}var c;if(!a.dialog)a.dialog=new x,a._mk=new f.mask,a.dialog.al.innerHTML=
'<p style="word-wrap: break-word;margin:20px 50px 5px 50px">'+(e||b.text)+'</p><button style="width:auto;height:auto;margin:10px 10px 10px 10px" class="close">\u5173\u95ed</button>',c=new k,c.center(a.dialog.al),c=l(a.dialog.al,b.dragTags),b.drag&&u(c.length==0?a.dialog.al:c,a.dialog.al);b.isloc&&(c=new k,c.center(a.dialog.al));a._mk.mask_show();a.dialog.show();if(b.time!="max"||d!=void 0)var g=setTimeout(m,d||b.time);a._close=function(){clearInterval(g);m()};v(l(a.dialog.al,b.close),a._close)};f.struc=
function(e,h){function g(){a._mk.mask_hide();a.dialog.style.display="none"}var c;if(!a.dialog||b.struc!=e)a._mk=new f.mask,b.ParIframe?(c=n(e||b.struc,document),a.dialog=d.body.appendChild(d.createElement("DIV")),a.dialog.innerHTML=(c.length!="undefined"?c:c[0]).outerHTML,c=n(e||b.struc),a.dialog=c.length!="undefined"?c:c[0],b.callback()):(c=n(e||b.struc),a.dialog=c.length!="undefined"?c:c[0]),b.struc=e,c=new k,c.center(a.dialog),c=l(a.dialog,b.dragTags),b.drag&&u(c.length==0?a.dialog:c,a.dialog);
b.isloc&&(c=new k,c.center(a.dialog));a._mk.mask_show();a.dialog.style.display="block";if(b.time!="max"||h!=void 0)var j=setTimeout(g,h||b.time);a._close=function(){clearInterval(j);g()};v(l(a.dialog,b.close),a._close)};f.Temps=function(e,d){function g(){a._mk.mask_hide();a.dialog.al.style.display="none"}var c;if(!a.dialog)a.dialog=new x,a._mk=new f.mask,a.dialog.al.innerHTML=B(b.Temps,e||b.data),c=new k,c.center(a.dialog.al),b.callback(),c=l(a.dialog.al,b.dragTags),b.drag&&u(c.length==0?a.dialog.al:
c,a.dialog.al);b.isloc&&(c=new k,c.center(a.dialog));a._mk.mask_show();a.dialog.al.style.display="block";if(b.time!="max"||d!=void 0)var j=setTimeout(g,d||b.time);a._close=function(){clearInterval(j);g()};v(l(a.dialog.al,b.close),a._close)};f.Drag=function(e,d){function f(){a.dialog.style.display="none"}if(!a.dialog){var c=n(b.dragBody||d);a.dialog=c.length!="undefined"?c:c[0];a.dialog.style.position=j.version()==6?"absolute":"fixed";if(b.dragLoc)c=a.dialog.style.display,(new k).center(a.dialog),
a.dialog.style.display=c}c=l(a.dialog,b.dragTags);u(c.length==0?a.dialog:c,a.dialog);if(b.time!="max")var g=setTimeout(f,b.time);a._close=function(){clearInterval(g);f()};v(l(a.dialog,b.close),a._close)};f.position=function(){};f.close=function(b,d){BQ.isString(b)?(n(b).style.display="none",d&&a._close()):a._close()};this._main=function(a,d){!g&&(g="alert");g=g.toLowerCase();switch(g){case "alert":f.alert(a,d);break;case "struc":f.struc(a,d);break;case "temps":f.Temps(a,d);break;case "drag":f.Drag(a,
d);b.drag=!0;break;default:f.alert(a)}};this._close=function(a,b){f.close(a,b)};switch(g){case "drag":f.Drag()}}var E={struc:null,Temps:"",Data:"",close:".close",text:"alert \u5f39\u51fa\u6d6e\u5c42",drag:!1,dragLoc:!1,dragTags:"",dragBody:"",diagCursor:"move",time:"max",isFrame:!0,opacity:0.5,backcolor:"#ccc",zIndex:9,ParIframe:!1,ParIframeMan:window.top,isloc:!1,alStyle:{border:"1px solid #D6E0B7",borderRadius:"5px 5px 5px 5px"},callback:function(){},scroll:!0,height:"auto",width:"auto"},C={display:"none",
position:"absolute",backgroundColor:"#ccc",zIndex:9,top:"0px",left:"0px",height:"768px",width:"1024px",backgroundImage:"url(about:blank;)",opacity:0.5,filter:"alpha(opacity=50)",mozOpacity:0.5};o.augment(s,{close:function(){},alert:function(g,b,l){this._main(g,b,l)},hide:function(){this.hide()},show:function(){},close:function(g,b){this._close(g,b)}});return s});
